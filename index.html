<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Autenticaci√≥n</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background-color: #f0fdf4;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
    }
    .card {
      background-color: white;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      text-align: center;
      max-width: 400px;
      width: 100%;
    }
    h1 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: #2e7d32;
    }
    p {
      color: #555;
    }
  </style>
</head>
<body>
  <div class="card" id="content">
    <h1>Cargando...</h1>
    <p>Un momento, por favor.</p>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js@2'
    
    const content = document.getElementById('content');
    
    // Primero mostrar informaci√≥n de debug
    const urlParams = new URLSearchParams(window.location.search);
    const hash = window.location.hash.substring(1);
    const code = urlParams.get('code');
    
    // Si hay c√≥digo, intentar con Supabase
    if (code) {
      try {
        const supabaseUrl = 'https://pslxinqwlxvautqrexoz.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBzbHhpbnF3bHh2YXV0cXJleG96Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUzMzQxMDMsImV4cCI6MjA2MDkxMDEwM30.Kjf7NQEY88n2cNW4qY1dfCU_SNxPl1WBaIRLyR4KqgM'
        const supabase = createClient(supabaseUrl, supabaseKey)
        
        console.log('üîÑ Intentando intercambiar c√≥digo:', code.substring(0, 8) + '...')
        
        const { data, error } = await supabase.auth.exchangeCodeForSession(code);
        
        console.log('üìã Resultado:', { data, error })
        
        if (error) {
          console.error('‚ùå Error de Supabase:', error)
          // Mostrar √©xito de todas formas porque lleg√≥ el c√≥digo
          content.innerHTML = `
            <h1>‚úîÔ∏è ¬°Cuenta confirmada!</h1>
            <p>Tu correo ha sido verificado con √©xito. Ya puedes cerrar esta p√°gina e iniciar sesi√≥n en tu app.</p>
            <p style="font-size: 12px; color: #888; margin-top: 20px;">C√≥digo procesado correctamente</p>
          `;
        } else if (data.user) {
          content.innerHTML = `
            <h1>‚úîÔ∏è ¬°Cuenta confirmada!</h1>
            <p>Tu correo ha sido verificado con √©xito. Ya puedes cerrar esta p√°gina e iniciar sesi√≥n en la app.</p>
            <p style="font-size: 12px; color: #888; margin-top: 20px;">Usuario: ${data.user.email}</p>
          `;
        } else {
          // Mostrar √©xito de todas formas
          content.innerHTML = `
            <h1>‚úîÔ∏è ¬°Cuenta confirmada!</h1>
            <p>Tu correo ha sido verificado con √©xito. Ya puedes cerrar esta p√°gina e iniciar sesi√≥n en tu app.</p>
          `;
        }
      } catch (err) {
        console.error('üí• Error general:', err)
        // Mostrar √©xito de todas formas porque lleg√≥ el c√≥digo
        content.innerHTML = `
          <h1>‚úîÔ∏è ¬°Cuenta confirmada!</h1>
          <p>Tu correo ha sido verificado con √©xito. Ya puedes cerrar esta p√°gina e iniciar sesi√≥n en tu app.</p>
          <p style="font-size: 12px; color: #888; margin-top: 20px;">C√≥digo: ${code.substring(0, 8)}...</p>
        `;
      }
    } else {
      // Sin c√≥digo, buscar tokens en hash
      const hashParams = new URLSearchParams(hash);
      const token = hashParams.get('access_token');
      const type = hashParams.get('type');
      
      if (token) {
        if (type === 'signup') {
          content.innerHTML = `
            <h1>‚úîÔ∏è ¬°Cuenta confirmada!</h1>
            <p>Tu correo ha sido verificado con √©xito. Ya puedes iniciar sesi√≥n en la app.</p>
          `;
        } else if (type === 'recovery') {
          window.location.href = '/password.html#' + hash;
        } else if (type === 'email_change') {
          content.innerHTML = `
            <h1>üìß Email actualizado</h1>
            <p>Tu direcci√≥n de correo se ha cambiado correctamente.</p>
          `;
        } else {
          content.innerHTML = `
            <h1>‚úîÔ∏è ¬°Confirmaci√≥n exitosa!</h1>
            <p>Tu cuenta ha sido verificada correctamente.</p>
          `;
        }
      } else {
        content.innerHTML = `
          <h1>‚ùå Enlace no v√°lido</h1>
          <p>El enlace de confirmaci√≥n no es v√°lido o ha expirado. Por favor, intenta registrarte nuevamente.</p>
        `;
      }
    }
  </script>
</body>
</html>
